# ADR: 인증 전략 의사결정 (Session vs JWT)

## 1. 배경 (Context)
현대의 웹 애플리케이션 개발에서 **JWT (Json Web Token)** 는 사실상 표준처럼 통용되고 있습니다. 많은 개발자들이 "로그인 = JWT"라고 생각하며 무비판적으로 도입하는 경향이 있습니다. 
DASH 프로젝트는 **Spring Security의 기본 세션 기반 인증(JSESSIONID)** 을 채택하고 있으며, 이것이 "레거시가 아닌가?" 하는 의문이 제기될 수 있습니다. 본 문서는 이에 대한 명확한 기술적 검토와 의사결정 근거를 기록합니다.

## 2. 비교 분석 (Trade-off Analysis)

### 2.1 JWT (Stateless Token)
*   **장점**:
    *   **완전한 무상태 (Stateless)**: 서버에 아무것도 저장하지 않으므로 무한한 수평 확장이 가능합니다.
    *   **MSA 친화적**: 여러 마이크로서비스가 공통의 저장소 없이도 토큰 자체의 서명만 검증하면 신원을 확인할 수 있습니다.
*   **치명적 단점 (우리가 채택하지 않은 이유)**:
    *   **강제 로그아웃 불가능 (No Revocation)**: 토큰이 한 번 발급되면 만료될 때까지 서버가 이를 제어할 수 없습니다. 사용자가 기기를 분실하거나 해킹당해도 서버는 손을 쓸 수 없습니다. (이를 막으려면 Blacklist를 DB/Redis에 구현해야 하는데, 그러면 결국 세션 방식과 똑같아집니다.)
    *   **보안 취약성**:
        *   `localStorage` 저장 시: XSS 공격 한 방에 토큰이 탈취됩니다.
        *   `Cookie` 저장 시: CSRF 공격에 취약해 별도 방어가 필요합니다.
    *   **트래픽 낭비**: 매 요청마다 긴 토큰 문자열을 헤더에 실어 보내야 합니다.

### 2.2 Session + Redis (Stateful but Scalable)
*   **장점 (우리가 채택한 이유)**:
    *   **최고 수준의 보안**: `HttpOnly`, `Secure`, `SameSite` 쿠키를 사용하면 자바스크립트로 접근 자체가 불가능하여 XSS로부터 안전합니다.
    *   **완벽한 제어권**: 관리자가 의심스러운 세션을 즉시 삭제(강제 로그아웃)할 수 있습니다.
    *   **단순성**: Spring Security가 이미 완벽하게 구현해두어 개발자가 보안 로직을 짤 필요가 없습니다 ("Don't roll your own crypto").
*   **단점 및 해결책**:
    *   단점: 서버 메모리를 사용하여 확장이 어렵다.
    *   해결책: **Spring Session + Redis** 조합을 사용하면 세션 객체를 외부 저장소(Redis)로 뺍니다. 이렇게 하면 JWT와 동일한 수준의 확장성을 가지면서 보안 이점은 그대로 유지할 수 있습니다.

## 3. 의사결정 (Decision)

**"우리는 JWT 대신 [Session + Redis] 전략을 채택한다."**

DASH는 현재 단일 서버(Monolithic) 구조에서 출발하여 점진적으로 확장하는 전략을 취합니다.
1.  **현재 (Phase 1)**: In-Memory Session (기본 설정). 빠르고 설정이 불필요함.
2.  **확장 시 (Phase 2)**: Redis Session 도입. 코드 변경 없이 의존성(`spring-session-data-redis`) 추가만으로 전환 가능.

## 4. 결론 (Conclusion)
JWT는 수십 개의 마이크로서비스가 서로 통신하거나, 모바일 앱(Native App)이 주력인 환경에서 유리합니다.
웹 브라우저 중심의 DASH 서비스 환경에서는 **세션 방식이 보안성, 구현 용이성, 관리 효율성 면에서 월등히 우수**합니다. 이는 시대에 뒤떨어진 것이 아니라, **보안(Security)을 최우선으로 고려한 엔지니어링 의사결정**입니다.
