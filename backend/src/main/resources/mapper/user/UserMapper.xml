<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.dash.user.infrastructure.mapper.UserMapper">

  <insert id="insert" parameterType="User" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO users (username, email, created_at, provider, provider_id, avatar_url)
    VALUES (#{username}, #{email}, #{createdAt}, #{provider}, #{providerId}, #{avatarUrl})
  </insert>

  <select id="selectById" resultType="User" parameterType="long">
    SELECT * FROM users WHERE id = #{id} AND deleted_at IS NULL
  </select>

  <select id="selectAll" resultType="User">
    SELECT * FROM users WHERE deleted_at IS NULL ORDER BY id
  </select>

  <select id="selectByProviderAndProviderId" resultType="User">
    SELECT * FROM users 
    WHERE provider = #{provider} AND provider_id = #{providerId} AND deleted_at IS NULL
  </select>

  <update id="update" parameterType="User">
    UPDATE users
    SET username = #{username}, email = #{email}, provider = #{provider}, 
        provider_id = #{providerId}, avatar_url = #{avatarUrl}, study_id = #{studyId},
        solvedac_handle = #{solvedacHandle}, solvedac_tier = #{solvedacTier},
        solvedac_rating = #{solvedacRating}, solvedac_class = #{solvedacClass},
        stats_last_synced_at = #{statsLastSyncedAt}
    WHERE id = #{id} AND deleted_at IS NULL
  </update>

  <update id="delete" parameterType="long">
    UPDATE users SET deleted_at = CURRENT_TIMESTAMP
    WHERE id = #{id} AND deleted_at IS NULL
  </update>

</mapper>
