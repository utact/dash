<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.dash.study.infrastructure.mapper.StudyMissionMapper">

  <insert id="insert" parameterType="StudyMission" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO study_missions (study_id, week, title, problem_ids, source_type, deadline, status, created_at)
    VALUES (#{studyId}, #{week}, #{title}, #{problemIds}, #{sourceType}, #{deadline}, #{status}, #{createdAt})
  </insert>

  <select id="selectById" resultType="StudyMission" parameterType="long">
    SELECT * FROM study_missions WHERE id = #{id}
  </select>

  <select id="selectByStudyId" resultType="StudyMission" parameterType="long">
    SELECT * FROM study_missions WHERE study_id = #{studyId} ORDER BY week
  </select>

  <select id="selectByStudyIdOrderByWeekDesc" resultType="StudyMission" parameterType="long">
    SELECT * FROM study_missions WHERE study_id = #{studyId} ORDER BY week DESC
  </select>

  <select id="selectByStudyIdAndWeek" resultType="StudyMission">
    SELECT * FROM study_missions WHERE study_id = #{studyId} AND week = #{week} LIMIT 1
  </select>

  <delete id="delete" parameterType="long">
    DELETE FROM study_missions WHERE id = #{id}
  </delete>

  <update id="update" parameterType="StudyMission">
    UPDATE study_missions
    SET title = #{title},
        problem_ids = #{problemIds},
        deadline = #{deadline},
        status = #{status}
    WHERE id = #{id}
  </update>

</mapper>
